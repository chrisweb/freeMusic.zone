#cloud-config
#playlist_guru

# Upgrade the instance on first boot
package_upgrade: true

# Send pre-generated ssh private keys to the server
ssh_keys:
  rsa_private: |
-----BEGIN RSA PRIVATE KEY-----
...
-----END RSA PRIVATE KEY-----

  rsa_public: ssh-rsa ... git@github.com

runcmd:
 - sudo yum install gcc-c++ make
 - sudo yum install openssl-devel
 - sudo yum install git
 - git clone git://github.com/joyent/node.git
 - cd node
 - ./configure
 - make
 - sudo make install

 - sudo su
 - vi /etc/sudoers
 - curl -L https://npmjs.org/install.sh | sh

 - cd /var
 - sudo mkdir www
 - cd www
 - sudo mkdir playlist_guru
 - cd playlist_guru

 - groupadd www
 - [ sh, -c, "usermod -a -G www ec2-user" ]

 - [ sh, -c, "chown -R root:www /var/www" ]
 - chmod 2775 /var/www

 - [ sh, -c, "chown -R root:www /var/www/playlist_guru" ]
 - chmod 2775 /var/www/playlist_guru

 - [ sudo, git, -i, /home/ec2-user/.ssh/deploy_key, "git@github.com:chrisweb/playlist_guru.git" ]

 - npm install -g grunt-cli
 - npm install -g bower

 - sudo npm install
 - sudo bower install

 - grunt buildprod

 - node server

final_message: "The system is finally up, after $UPTIME seconds"

# vim:syntax=yaml expandtab